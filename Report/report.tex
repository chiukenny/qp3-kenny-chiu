\documentclass[10pt]{article}
\input{header}
\input{defs}

\title{\todo\\\vspace{0.5em}\large{STAT 548 Qualifying Paper}}
\author{Kenny Chiu}
\date{\today}

\bibliography{refs.bib}

\begin{document}

\maketitle

\vspace{2em}

\begin{abstract}
\todo
\end{abstract}

\vspace{2em}


\section{Introduction}


\section{Notation}

Throughout this report, we closely follow the notation used by \textcite{Forastiere:2021}. Let $G=(\calN,\calE)$ be an undirected network where $\calN$ is a set of $N$ units (nodes) and $\calE$ is a set of edges $(i,j)$. A partition~$(i,\Ni,\Nmi)$ of $\calN$ describes unit~$i$'s neighbourhood~$\calN_i$ (the set of $N_i$ units connected to unit $i$) and the set~$\calN_{-i}$ of all other units that are not $i$ and are not in $\calN_i$. Let $Z_i\in\{0,1\}$ be the treatment assigned to unit $i$ and $Y_i\in\calY$ the observed outcome of unit $i$. Denote the treatment and outcome vector for the population~$\calN$ as $\bfZ$ and $\bfY$, respectively, and the corresponding vectors for partition~$(i,\Ni,\Nmi)$ as $(Z_i,\ZNi,\ZNmi)$ and $(Y_i,\YNi,\YNmi)$. Let $G_i=g_i(\ZNi)\in\calG_i$ be some known and well-specified summary~$g_i$ of the treatments in unit~$i$'s neighbourhood, and denote the vector of neighbourhood treatments for the population as $\bfG$. Depending on the size of a unit's neighbourhood, the space $\calG_i$ may differ between units. Let $V_g=\{i\in\calN:g\in\calG_i\}$ denote the subset containing $v_g$ units that have $g$ as a possible value for the neighbourhood treatment. Let $\bfX_i\in\calX$ be a vector of covariates for unit~$i$ that partitions into individual-level characteristics $\Xind_i\in\calX^\text{ind}$ and neighbourhood-level/aggregated individidual-level characteristics $\Xneigh_i\in\calX^\text{neigh}$.


\section{Proposed methodology in context of the literature}

\todo In this section, we explain the method proposed by \textcite{Forastiere:2021} and discuss its relevance in the context of the related literature. We also discuss its advantages over other methods used in similar contexts.

\subsection{Setting, objective and method}

\textcite{Forastiere:2021} examine the problem of performing causal inference of treatment effects from observational network data under interference. The setting is challenging for causal inference because
\begin{enumerate}
\item
the assignment mechanism of treatments is unknown with observational data and so estimated effects may be non-causal in the presence of unmeasured confounders, and
\item
naive inference methods that ignore interference may produce biased estimates.
\end{enumerate}
In the randomized study literature, these issues can generally be dealt with by designing the study in such a way that the influence of confounders is minimized and that inference methods that account for interference can be used \parencite[e.g.,][]{Saveski:2017,Jagadeesan:2020,Imai:2021,Doudchenko:2020}. In the observational setting, these considerations need to be addressed by the inference method in the analysis phase. \citeauthor{Forastiere:2021} consider a setting involving a binary treatment (e.g., intervention and control) and where the interference on a unit is limited to that of its immediate neighbouring units. They propose a method to estimate the causal treatment and spillover (interference) effects that yield unbiased estimates under certain assumptions.
\\

Under the potential outcome framework, the general procedure for estimating effects is to match units into sets based on covariate values, compute the effect contrast within each matched set, and estimate the effect by the (weighted) average of the contrasts across sets. However, matching may be difficult when the space of possible covariate values is large or if there are many covariates. \textcite{Forastiere:2021} address this problem in their proposed method by instead matching on a defined joint propensity score~$\psi(z;g;x)$ that factorizes into a neighbourhood propensity score~$\lambda(g;z;\bfx^g)$ (probability of being exposed to neighbourhood treatment $g$ given individual treatment $z$ and relevant covariates $\bfx^g$) and an individual propensity score~$\phi(z;\bfx^z)$ (probability of being assigned treatment $z$ given relevant covariates $\bfx^z$). Note that $\bfX^g$ and $\bfX^z$ do not necessarily correspond to $\Xneigh$ and $\Xind$, respectively, and as they may not be disjoint. The steps for their propensity-based method are as follows:
\begin{enumerate}

\item
\textbf{Subclassify units}.
\begin{enumerate}
\item
Fit a logistic regression model on the individual treatments~$Z_i$ given covariates~$\bfX_i^z$, and use the model to predict the individual propensity scores~$\phi(1;\bfX_i^z)$.
\item
Partition the units into $J$ subclasses $B_j$, $j\in\{1,\ldots,J\}$, based on similar estimated individual propensity scores~$\hat{\phi}(1;\bfX_i^z)$ and such that each subclass is approximately balanced in the number of treated and untreated units.
\end{enumerate}

\item
\textbf{Estimate potential outcomes}. Let $B_j^g=	V_g\cap B_j$. For each subclass~$B_j$:
\begin{enumerate}
\item
Fit some regression model on the neighbourhood treatments $G_i$ given the individual treatments~$Z_i$ and covariates~$\bfX_i^g$, and use the model to predict the neighbourhood propensity scores~$\lambda(g;z;\bfX_i^g)$.
\item
Fit some regression model on the potential outcomes~$Y_i(z,g)$ given the estimated neighbourhood propensity scores~$\hat{\lambda}(g;z;\bfX_i^g)$.
\item
Estimate the dose-response function by averaging over the estimated potential outcomes for a particular level of the joint treatment, i.e.,
\[
\hat{\mu}_j(z,g;V_g) = \frac{\sum_{i\in B_j^g}\hat{Y}_i(z,g)}{\left|B_j^g\right|}\;.
\]
\end{enumerate}

\item
\textbf{Estimate the average dose-response function} (ADRF) $\mu(z,g;V_g)=\E\left[Y_i(z,g)|i\in V_g\right]$ for a particular level of the joint treatment by taking the weighted average of the estimated dose-response functions over the subclasses, i.e.,
\[
\hat{\mu}(z,g;V_g) = \sum_{j=1}^J\hat{\mu}_j(z,g;V_g)\left(\frac{\left|B_j^g\right|}{v_g}\right) \;.
\]

\item
\textbf{Estimate} the treatment effects $\tau(g)$, overall treatment effect $\tau$, spillover effects $\delta(g;z)$, and overall spillover effects $\Delta(z)$ by
\begin{align*}
\hat{\tau}(g) &= \hat{\mu}(1,g;V_g) - \hat{\mu}(0,g;V_g) \;, & \hat{\tau}&=\sum_{g\in\calG}\hat{\tau}(g)\P(G_i=g) \;, \\
\hat{\delta}(g;z) &= \hat{\mu}(z,g;V_g) - \hat{\mu}(z,0;V_g) \;, & \hat{\Delta}(z) &= \sum_{g\in\calG}\hat{\delta}(g;z)\P(G_i=g)\;.
\end{align*}

\end{enumerate}
\textcite{Forastiere:2021} show that their estimators for the treatment and spillover effects are unbiased under three assumptions, the first two of which form the Stable Unit Treatment on Neighbourhood Value Assumption (SUTNVA, a generalization of SUTVA that relaxes the no interference assumption to allow interference of immediate neighbours) and the third being an unconfoundedness assumption that says the treatment assignment mechanism is conditionally independent of the outcomes for the given set of covariates.

\subsection{Comparison to the literature}

The literature that examines the similar problem of causal inference in observational data under general forms of interference is still relatively new. We summarize the common approaches in this literature and discuss how the work by \textcite{Forastiere:2021} fits in. We also briefly highlight other work in the related literature.

\subsubsection{Other approaches under the same context}

As noted by \citeauthor{Forastiere:2021}, the majority of the works dealing with the same context involve either inverse probability-weighted (IPW) estimators \parencite{Liu:2016} or targeted maximum likelihood estimators (TMLE) \parencite{VanDerLaan:2014,Sofrygin:2017,Ogburn:2017} for the causal treatment effect. The main advantage of the method proposed by \textcite{Forastiere:2021} over these two approaches is the weaker assumptions that it requires.
\\

IPW estimators are weighted averages of the outcomes where the weights are defined with respect to a hypothetical allocation strategy (an assumed distribution over the neighbouring treatments) and a known or correctly modelled generalized propensity score. The Bernoulli allocation strategy \parencite{Tchetgen:2012} is commonly used, which assumes that each unit in the neighbourhood is treated independently with probability $\alpha$ and that a unit's assignment is independent of its neighbours' assignment. This assumption rules out homophily---the tendency for units with similar characteristics to form ties---which is generally a strong and unrealistic assumption to make \parencite{Shalizi:2011}. In contrast, the estimators proposed by \textcite{Forastiere:2021} only use the observed neighbourhood treatments, and therefore no assumptions that explicitly rule out homophily are made (though the issue may still manifest as an unmeasured confounder if the unconfoundedness assumption does not hold for the given set of covariates). Both the IPW estimators and the estimators proposed by \textcite{Forastiere:2021} rely on being able to correctly model the joint propensity score.
\\

TMLEs are obtained by maximizing the likelihood of the outcomes defined on a structural equation model. Similar to the IPW estimators, TMLE typically involves a randomization assumption \parencite{VanDerLaan:2014} on the model where the conditional joint distribution of the treatment assignments factorizes into independent conditionals given the covariates for all units, and similarly for the conditional joint distribution of the outcomes given the covariates and the treatment assignments. In comparison, the unconfoundedness assumption in the method proposed by \textcite{Forastiere:2021} makes a weaker assumption where the outcome and treatment assignment of each unit is conditionally independent given only the covariates of that unit. The significance of these assumptions again circle back to the argument of disregarding homophily and/or other venues of confounding. It is notable that extensions of TMLE that allow for limited forms of homophily were later introduced \parencite{Ogburn:2017}.
\\

More recently, approaches that can be described as extensions of \textcite{Forastiere:2021}'s method have been proposed. \textcite{Jackson:2020} proposed estimators based on propensity score matching but which also explicitly account for homophily by modeling neighbourhood treatment assignments as an incomplete information game. \textcite{Sanchez:2021} questioned the justification of the unconfoundedness assumption with respect to the constructed propensity score (which may be high-dimensional and challenging to estimate accurately), and proposed a two-step method where a defined network propensity score is first estimated and then used as inverse weights to match units.

\subsubsection{Other contexts}

We briefly highlight other works in the literature that consider a slightly different setting of the causal inference problem in observational data under interference. The difference in settings makes it difficult to directly compare the proposed approaches to that of \textcite{Forastiere:2021}.
\\

A large body of the literature examine the inference problem under the assumption of partial interference where units are partitioned into groups with no spillover effects between groups. The focus on partial interference settings seems to be primarily due to momentum of earlier works \parencite[e.g.,][]{Sobel:2006,Hudgens:2008} that looked at causal inference in randomized studies with interference, in which group-randomization tends to be more practical. Examples of recent work that assume partial interference include the work by \textcite{Liu:2019}, \textcite{Barkley:2020}, and \textcite{Qu:2021}. IPW estimators are commonly used in the partial interference setting as they were originally introduced for grouped observational data \parencite{Tchetgen:2012}.
\\

A small number of works consider more specific and niche contexts. For example, \textcite{Toulis:2018} explore the problem of treatment entanglement (where treatment assignments are assumed to satisfy certain restrictions) and proposes a propensity score-based estimator. \textcite{Zigler:2021} focus on the problem of bipartite causal inference with interference (where the treatment is applied to one unit and the outcome is measured on another) and proposes a IPW estimator.
%Outside of the observational setting, there are many works that study causal inference in randomized studies with potential interference. These works generally examine study designs that allow for treatment effect estimation in the presence of interference under varying contexts \parencite[e.g.,][]{Saveski:2017,Jagadeesan:2020,Imai:2021,Doudchenko:2020}


\section{Potential bias of naive estimator when unconfoundedness holds}

\todo In this section, we describe a simple example that illustrates the relevance of Theorem~2.A, Corollary~2 and Corollary~3 in the paper by \textcite{Forastiere:2021}. Specifically, we show how given a simple network under certain assumptions, an unbiased naive estimator for the treatment effect that assumes SUTVA may be biased depending on the exact treatment assignment mechanism.
\\

Consider some undirected network $G=(\calN,\calE)$ where every unit is paired (has an edge) with exactly one other unit. For simplicity, we index a unit by $i\in\bbN$ for the pair and $j\in\{0,1\}$ for the unit within a pair. Denote $Z_{ij}\in\{0,1\}$ as the treatment assignment of unit $j$ in pair $i$. Let the neighbourhood treatment~$G_{ij}$ be whether a unit's paired counterpart is treated. Therefore, $\calG_{ij}=\{0,1\}$ for all units in the network and $V_g=\calN$ for all $g\in\{0,1\}$. For convenience of notation, we drop the dependence on $V_g$ where applicable. Let $\bfX_{ij}=X_{ij}\in\{0,1\}$ be some covariate available for each unit, and assume that the covariates of the units in the network are generated independently with $\P(X_{ij}=1)=\P(X_{ij}=0)=0.5$. Other details, such as the space of outcomes $\calY$ and the size of $\calN$, are assumed but left unspecified due to being irrelevant for the discussion.
\\

\todo: make assignment probabilistic \parencite{Imbens:2015}. We examine the network under two settings. In the first setting, suppose that the covariate $X_{ij}$ exactly determines the treatment status of a unit, i.e., $Z_{ij} = X_{ij}$. Because $X_{ij}$ are generated independently, it follows that $Z_{ij}$ and $G_{ij}$ are conditionally independent given $X_{ij}$ in this setting (they are independent unconditionally regardless of $X_{ij}$). In the second setting, suppose that the treatment assignment mechanism follows
\[
Z_{ij} = \begin{cases} 1 & \text{if } X_{i1} = X_{i2} \\ 0 & \text{otherwise} \end{cases} \;.
\]
This corresponds to a homophily situation where the units in a pair are treated only if they share the same value of the covariate. Thus, $Z_{ij}$ and $G_{ij}$ are not conditionally independent given $X_{ij}$ in this setting as a unit can only have values $(Z_{ij}=1,G_{ij}=1)$ or $(Z_{ij}=0,G_{ij}=0)$. In both settings, we further assume that Assumption~1 (no multiple versions of treatment), Assumption~2 (neighbourhood interference), and Assumption~3 (unconfoundedness) of \textcite{Forastiere:2021} hold. Hence, the assumptions of Corollary~1 are satisfied in the first setting, and the assumptions of Corollary~2 are satisfied in the second setting.

\subsection{Setting~1: conditionally independent individual and neighbourhood treatments}

In our first setting, the individual treatment $Z_{ij}$ and neighbourhood treatment $G_{ij}$ are conditionally independent given $X_{ij}$. \todo example? Then by Corollary~1, an estimator that is unbiased under SUTVA will still be unbiased under the assumptions of our setting.
\\

The treatment effects $\tau(g)$ and overall treatment effect $\tau$ in our example are given by
\begin{align*}
\tau(0) &= \mu(1,0) - \mu(0,0) \;, \\
\tau(1) &= \mu(1,1) - \mu(0,1) \;, \\
\tau &= \tau(0)\P(G_{ij}=0) + \tau(1)\P(G_{ij}=1) \\
&= 0.5\left(\mu(1,0) + \mu(1,1) - \mu(0,0) - \mu(0,1)\right) \;.
\end{align*}
The naive estimator $\tau_{X}^\text{obs}$ that assumes SUTVA estimates the quantity
\begin{align*}
\tau_{X}^\text{obs} &= \left(\E\left[Y_{ij}|Z_{ij}=1,X_{ij}=0\right] - \E\left[Y_{ij}|Z_{ij}=0,X_{ij}=0\right]\right)\P(X_{ij}=0) \\
&\quad + \left(\E\left[Y_{ij}|Z_{ij}=1,X_{ij}=1\right] - \E\left[Y_{ij}|Z_{ij}=0,X_{ij}=1\right]\right)\P(X_{ij}=1) \\
&= \E\left[Y_{ij}|Z_{ij}=1\right] - \E\left[Y_{ij}|Z_{ij}=0\right] \\
&= \left(\E\left[Y_{ij}|Z_{ij}=1,G_{ij}=0\right] - \E\left[Y_{ij}|Z_{ij}=0,G_{ij}=0\right]\right)\P(G_{ij}=0) \\
&\quad + \left(\E\left[Y_{ij}|Z_{ij}=1,G_{ij}=1\right] - \E\left[Y_{ij}|Z_{ij}=0,G_{ij}=1\right]\right)\P(G_{ij}=1) \\
&= 0.5\left(\mu(1,0) + \mu(1,1) - \mu(0,0) - \mu(0,1)\right)
\end{align*}
where the third equality as $X_{i1}\condind X_{i2}$ (and so $Z_{ij}\condind G_{ij}$) and the fourth equality from Assumptions~1 and 2. Note that the conditional expectations where The second equality follows under the ``super-population'' perspective \parencite{Forastiere:2021} where expectations should be interpreted as the exp \todo (impossible event?) The above derivations suggest that $\tau_{X}^\text{obs}-\tau=0$, and therefore an unbiased estimator of the naive effect estimator is also unbiased for the treatment effect in this setting.

\subsection{Setting~2: correlated individual and neighbourhood treatments}

\begin{itemize}

\item
Setting 2:
\begin{align*}
\tau(1) &= \mu(1,1) \\
\tau(0) &= - \mu(0,0) \\
\tau &= 0.5(\mu(1,1) - \mu(0,0))
\end{align*}
\begin{align*}
\tau_{X^*}^\text{obs} &= 0.5(\E[Y|Z=1,X=0] - \E[Y|Z=0,X=0] + \E[Y|Z=1,X=1] - \E[Y|Z=0,X=1]) \\
&= \E[Y|Z=1] - \E[Y|Z=0] \\
&= \E[Y|Z=1,G=1]P(G=1|Z=1) + \E[Y|Z=1,G=0]P(G=0|Z=1) - \E[Y|Z=0,G=1]P(G=1|Z=0) - \E[Y|Z=0,G=0]P(G=0|Z=0) \\
&= \E[Y|Z=1,G=1] - \E[Y|Z=0,G=0]
\end{align*}
\begin{align*}
&\tau_{X^*}^\text{obs} \\
&= (\E[Y(1,1)|X=1]P(G=1|Z=1,X=1) - \E[Y(0,1)|X=1]P(G=1|Z=0,X=1))P(X=1) \\
& + (\E[Y(1,0)|X=1]P(G=0|Z=1,X=1) - \E[Y(0,0)|X=1]P(G=0|Z=0,X=1))P(X=1) \\
& + (\E[Y(1,1)|X=0]P(G=1|Z=1,X=0) - \E[Y(0,1)|X=0]P(G=1|Z=0,X=0))P(X=0) \\
& + (\E[Y(1,0)|X=0]P(G=0|Z=1,X=0) - \E[Y(0,0)|X=0]P(G=0|Z=0,X=0))P(X=0) \\
&= 0.5\E[Y(1,1)|X=1] - 0.5\E[Y(0,0)|X=1] + 0.5\E[Y(1,1)|X=0] - 0.5\E[Y(0,0)|X=0] \\
&= \E[Y(1,1)] - \E[Y(0,0)]
\end{align*}
\begin{align*}
&\tau_{X^*}^\text{obs} - \tau \\
&=(\E[Y|Z=1,G=1,X=1]-\E[Y|Z=1,G=0,X=1])(P(G=1|Z=1,X=1)-P(G=1|X=1))P(X=1) \\
&- (\E[Y|Z=0,G=1,X=1]-\E[Y|Z=0,G=0,X=1])(P(G=1|Z=0,X=1)-P(G=1|X=1))P(X=1) \\
&+ (\E[Y|Z=1,G=1,X=0]-\E[Y|Z=1,G=0,X=0])(P(G=1|Z=1,X=0)-P(G=1|X=0))P(X=0) \\
&- (\E[Y|Z=0,G=1,X=0]-\E[Y|Z=0,G=0,X=0])(P(G=1|Z=0,X=0)-P(G=1|X=0))P(X=0) \\
&= 0.25\E[Y|Z=1,G=1,X=1] - 0.25\E[Y|Z=0,G=0,X=1] + 0.25\E[Y|Z=1,G=1,X=0] - 0.25\E[Y|Z=0,G=0,X=0] \\
&= 0.5\E[Y|Z=1,G=1] - 0.5\E[Y|Z=0,G=0]
\end{align*}

\end{itemize}


\section{Reproducing results of simulation study}

\todo In this section, we aim to (partially) reproduce the results of the simulation study conducted by \textcite{Forastiere:2021}. Note that we work with only the subset of the data that they use that is publicly accessible. The subset contains data for 6504 students (\todo: schools?) as opposed to the 16,410 students from 29 schools considered in their study.
\\


\section{Extending the simulation study}

\todo In this section, we consider a small extension to the simulation study.
\\


\section{Critical appraisal and concluding remarks}

\todo We conclude this report with a critical appraisal of the method proposed by \textcite{Forastiere:2021}.

\todo contributions, limitations

\todo unconfoundedness assumption? \textcite{Sanchez:2021}


\newpage


\begin{refcontext}[sorting=nyt]
\printbibliography
\end{refcontext}


%\newpage

%\appendix

%\section{}

\end{document}



The work by \textcite{Forastiere:2021} fits into the niche literature that looks at performing causal inference on observational network data in the presence of interference. \textcite{Forastiere:2021} formulate the network interference problem under the potential outcome framework (\todo cite), and propose a procedure to estimate causal treatment and spillover effects (as defined under their formulation) based on a joint propensity score that they define for network data. Their proposed propensity-adjusted estimators are unbiased under three assumptions, two of which form the Stable Unit Treatment on Neighbourhood Value Assumption (SUTNVA, a generalization of SUTVA that relaxes the no interference assumption to allow interference from directly connected nodes) and the third being an unconfoundedness assumption that says the treatment assignment mechanism is conditionally independent of the outcomes for some set of covariates. In addition, \textcite{Forastiere:2021} also derive the bias of SUTVA-assuming estimators when SUTVA does not hold or when the unconfoundedness assumption does not hold for the given set of covariates. The problem formulation, the proposed estimation procedure (based on a defined joint propensity score), and the derived bias of the naive estimator are the main contributions of \citeauthor{Forastiere:2021}.

\item
$\calN=\{1,2,3,4\}$, $\calE=\{(1,2),(3,4)\}$

\item
$\calY=\bbR$, $Z_i\in\{0,1\}$, $\calX=\{0,1\}$, $\calG_i=\{0,1\}$ for all $i$ (has treated friend), $V_g=\calN$ for all $g$

\item
If unconfoundedness assumption holds:
\begin{align*}
Y_i(z,g)|X_i &\sim N(\mu(z,g,X_i),1) \\
\mu(z,g,X_i) &= 6X_i + 3z + g
\end{align*}
Make deterministic:
\[
Y_i(z,g)|X_i = \mu(z,g,X_i) = 6X_i+3z+g
\]

\item
Corollary~1 holds:
\[
\textrm{logit}(P(Z_i=1)) = \log(0.5) + \log(4)X_i
\]
Make deterministic:

\item
Corollary~2 holds:
\[
\textrm{logit}(P(Z_i=1)) = \log(0.5) + \log(4)X_i + \log(2)\sum_{(i,j)\in\calE}X_j
\]


\item
Consider network where all units are in pairs.

$\calY=\bbR$, $Z_i\in\{0,1\}$, $\calX=\{0,1\}$, $\calG_i=\{0,1\}$ for all $i$ (has treated friend), $V_g=\calN$ for all $g$. $\P(X=1)=0.5$.

Corollary~1 setting: $Z_i=\mathbbm{1}(X_i=1)$ ($Z_i$ and $G_i$ entirely independent).

Corollary~2 setting: $Z_i=\sim X_i\otimes X_i'$ ($Z_i$ and $G_i$ not conditionally independent given $X_i$; only possible combinations are $(Z_i=1,G_i=1)$ and $(Z_i=0,G_i=0)$).

Show unbiasedness/biasedness of naive estimator (not accounting for spillover) based on averaging


\item
Setting 1:
\begin{align*}
\tau(1) &= \mu(1,1) - \mu(0,1) \\
\tau(0) &= \mu(1,0) - \mu(0,0) \\
\tau &= 0.5(\mu(1,0) + \mu(1,1) - \mu(0,0) - \mu(0,1)) \\
\end{align*}
\begin{align*}
\tau_{X^*}^\text{obs} &= 0.5(\E[Y|Z=1,X=0] - \E[Y|Z=0,X=0] + \E[Y|Z=1,X=1] - \E[Y|Z=0,X=1]) \\
&= \E[Y|Z=1] - \E[Y|Z=0] \\
&= \E[Y|Z=1,G=1]P(G=1|Z=1) + \E[Y|Z=1,G=0]P(G=0|Z=1) - \E[Y|Z=0,G=1]P(G=1|Z=0) - \E[Y|Z=0,G=0]P(G=0|Z=0) \\
&= 0.5(\E[Y|Z=1,G=1] + \E[Y|Z=1,G=0] - \E[Y|Z=0,G=1] - \E[Y|Z=0,G=0])
\end{align*}