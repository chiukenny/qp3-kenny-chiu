\documentclass[10pt]{article}
\input{../Report/header}
\input{../Report/defs}

\bibliography{../Report/refs.bib}

\begin{document}

\section{Identification and Estimation of Treatment and Interference Effects in Observational Studies on Networks}

Based on \parencite{Forastiere:2021}.

\subsection{Background and motivation}

\begin{itemize}

\item
Interference: in experimental and observational studies, when a treatment assigned to one unit has an effect on others.

\item
Spillover effects: the effects of interference.

\item
Problem and goal: given a known network where the assignment mechanism of the treatment is unknown, estimate (1) the causal effect of individual treatment and (2) the spillover effect from treatments of others.

\item
Contributions of paper:
\begin{enumerate}
\item
A general formulization for the problem of interference in networks under the potential outcome framework.
\item
Derivation of the bias for estimators of the treatment effect when SUTVA is wrongly assumed.
\item
A joint propensity score (probability of assignment to particular individual and neighborhood treatment given observed covariates) with balancing properties, and a joint propensity score-based estimator.
\end{enumerate}

\end{itemize}

\subsection{Interference based on exposure to neighbourhood treatment}

Notation:
\begin{itemize}

\item
Undirected network $G=(\calN,\E)$ where $\calN$ is a set of $N$ nodes and $\E$ is a set of edges $(i,j)=(j,i)$.

\item
Define partition $(i,\Ni,\Nmi)$ around node $i$ where $\calN_i$ is set of $N_i$ nodes (neighbourhood) that contains all nodes $j$ connected to $i$ and $\calN_{-i}$ is set of all other nodes not $i$ and not in $\calN_i$.

\item
$Z_i\in\{0,1\}$ treatment assignment to unit $i$, $\bfZ$ treatment vector for population $\calN$, and $(Z_i,\ZNi,\ZNmi)$ partitions for $(i,\Ni,\Nmi)$.

\item
$Y_i\in\calY$ observed outcome of unit $i$, $\bfY$ outcome vector for population $\calN$, and $(Y_i,\YNi,\YNmi)$ partitions for $(i,\Ni,\Nmi)$.

\item
$\bfX_i\in\calX$ vector of covariates for unit $i$ and decomposes into $\Xind_i\in\calX^\text{ind}$ (individual-level characteristics) and $\Xneigh_i\in\calX^\text{neigh}$ (neighbourhood-level characteristics and aggregates of individual-level covariates).

\end{itemize}

Potential outcomes and neighbourhood interference:

\begin{itemize}

\item
Under presence of interference, the observable outcome at node $i$ is a function of the treatment assignment vector and can be written as $Y_i(\bfZ)$. This is well-defined only if Assumption~1 holds.

\item
Assumption~1: if $\bfZ=\bfz$ then $Y_i=Y_i(\bfz)$. (The outcome only depends on the treatment assignments and not the mechanism used to assign treatments.)

\url{https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4219328/}

\item
Stable unit treatment value assumption (SUTVA): Assumption~1 and no interference between individuals (i.e., $Y_i(Z_i,\ZNi,\ZNmi)=Y_i(Z_i,\ZNi',\ZNmi')$ for all $\ZNi,\ZNi',\ZNmi,\ZNmi'$).

\item
(Relaxing SUTVA Assumption~2 to allow neighbourhood interference)

Assumption~2: for a $g_i:\{0,1\}^{N_i}\rightarrow \calG_i$ s.t. $g_i(\ZNi)=g_i(\ZNi')$ for all $\ZNi,\ZNi'$, for all $\ZNmi,\ZNmi'$ we have
\[
Y_i(Z_i,\ZNi,\ZNmi) = Y_i(Z_i,\ZNi',\ZNmi')
\]
(The outcome of node $i$ only depends on its treatment assignment and some summary of the treatment assignments of its neighbours, e.g., proportion.)

Define $G_i=g_i(\ZNi)$ and assume $g_i$ known and well-specified.

\item
Stable unit treatment on neighbourhood value assumption (SUTNVA): Assumption~1 and Assumption~2.

\end{itemize}

Individual and neighbourhood treatments:

\begin{itemize}

\item
Node $i$ is assigned to treatment if $Z_i=1$ (control otherwise) and is exposed to neighbourhood treatment $G_i=g$ if $g_i(\ZNi)=g$.

\item
Let $\bfG$ be the vector of neighbourhood treatments to which units are exposed to, $\bfX$ the covariate matrix collecting all vectors $\bfX_i$, and $\bfY(z,g)$ the collection of potential outcomes $Y_i(z,g)$ for all units.

\item
The assignment mechanism can be written as
\[
\P(\bfZ,\bfG|\bfX,\{\bfY(z,g),z\in\{0,1\},g\in\calG\}) =
\begin{cases}
\P(\bfZ|\bfX,\{\bfY(z,g),z\in\{0,1\},g\in\calG\}) & \text{if } \bfG=\bfg(\bfZ) \\
0 & \text{otherwise}
\end{cases}
\]
where $\bfg(\bfZ)=[g_1(\bfZ_{\calN_1},\ldots,g_N(\bfZ_{\calN_N}))]$.

\end{itemize}

Estimating main and spillover effects:

\begin{itemize}

\item
A potential outcome $Y_i(z,g)=Y_i(Z_i=z,G_i=g)$ is defined only for a subset of nodes $V_g=\{i:g\in\calG_i\}$ with cardinality $v_g$. For units with degree zero, denote $V_{\emptyset}=\{i:N_i=0\}$ the set of units without neighbours.

\item
Super-population perspective: potential outcomes of graph $G$ are fixed and expectations are simple averages of these outcomes, i.e., $\E[\bullet|i\in U]=\frac{1}{|U|}\sum_{i\in U}(\bullet)$ and $\P(\bullet|i\in U)=\frac{1}{|U|}\sum_{i\in U}I(\bullet)$ for some subset $U$ of the super-population.

\item
Denote the marginal mean of the potential outcome $Y_i(z,g)$ in $V\subseteq V_g$ by
\[
\mu(z,g;V) = \E[Y_i(z,g)|i\in V]
\]
which can be viewed as an average dose-response function (ADRF) for subset $V$ depending on the individual and neighbourhood treatments.

\item
Causal effects are defined as comparisons between the marginal mean of different potential outcomes. The treatment effect (main effect) is defined as
\[
\tau(g) = \mu(1,g;V_g) - \mu(0,g;V_g)
\]
The overall main effect is defined as the average effect of individual treatments over the distribution of the neighbourhood treatment, i.e.,
\[
\tau = \sum_{g\in\calG}\tau(g)\P(G_i=g) \qquad\left( = \E_\calG[\tau(g)]\right)
\]
where $\calG=\bigcup_i\calG_i$ and $i$ is a unit sampled from the population.

\item
The (causal) spillover effect of having the neighbourhood treatment set to level $g$ versus 0 when the unit is under treatment $z$ is
\[
\delta(g;z) = \mu(z,g;V_g) - \mu(z,0;V_g)
\]
The overall spillover effect is the average spillover effect over the distribution of the neighbourhood treatment, i.e.,
\[
\Delta(z) = \sum_{g\in\calG} \delta(g;z)\P(G_i=g) \qquad (=\E_\calG[\delta(g;z)])
\]

\item
The total effect is defined as
\begin{align*}
\text{TE} &= \sum_{g\in\calG}\E\left[Y_i(1,g)-Y_i(0,0)|i\in V_g\right]\P(G_i=g) \\
&= \sum_{g\in\calG}\E\left[Y_i(1,g)-Y_i(0,g)+Y_i(0,g)-Y_i(0,0)|i\in V_g\right]\P(G_i=g) \\
&= \tau + \Delta(0)
\end{align*}
i.e., the sum of overal main and spillover effects.

\end{itemize}

Unconfoundedness of the joint treatment:

\begin{itemize}

\item
(Re-defined unconfoundedness assumption from SUTVA for SUTNVA)

Assumption~3: for all $z\in\{0,1\}$, $g\in\calG_i$ and all $i$, $Y_i(z,g)\condind Z_i, G_i|X_i$. (Given covariates for unit $i$, the potential outcome of unit $i$ given the treatment assignments for the graph is independent of the treatment assignment for unit $i$. Significance: units are not assigned to the treatment depending on the potential outcomes.)

\item
Theorem~1 (identification of ADRF): under Assumptions~1, 2, and 3,
\begin{align*}
\E\left[Y_i(z,g)|i\in V_g\right] &= \sum_{\bfx\in\calX}\E\left[Y_i|Z_i=z,G_i=g,\bfX_i=\bfx,i\in V_g\right]\P(\bfX_i=\bfx|i\in V_g) \\
& := \Yobs \\
&\left(= \E_\calX\left[\left.\E\left[Y_i|Z_i=z,G_i=g,\bfX_i=\bfx,i\in V_g\right]\right|i\in V_g\right]\right)
\end{align*}
(Average potential outcome for subset $V_g$ is given by the weighted averaged of observed outcomes of units with $Z_i=z$ and $G_i=g$ and with same values of covariates. Significance: this allows estimation of the ADRF and therefore the causal effects of interest. If we only have a sample rather than the population, an unbiased estimator of the ADRF can be obtained from an unbiased estimator of conditional outcome mean $\Yobs$.)

\end{itemize}

\subsection{Bias when SUTVA is wrongly assumed}

Naive estimator:

\begin{itemize}

\item
Under SUTVA, the potential outcome is only indexed by the individual treatment assignment. The average treatment effect is then defined as
\[
\tausutva = \E\left[Y_i(Z_i=1) - Y_i(Z_i=0)\right]
\]

\item
Covariance-adjusted estimators estimate the quantity
\[
\tau_{X^*}^\text{obs} = \sum_{\bfx\in\calX^*}\left(\E\left[Y_i|Z_i=1,\bfX_i^*=\bfx\right] - \E\left[Y_i|Z_i=0,\bfX_i^*=\bfx\right]\right)\P(\bfX_i^*=\bfx)
\]
where $\bfX_i^*\in\calX^*$ is a subset of covariates (under SUTVA, neighbourhood covariates would not be considered and so $\bfX_i=\Xind_i$). (If the SUTVA unconfoundedness assumption holds, then $\tausutva=\tau_{X^*}^\text{obs}$ and so an unbiased estimator of $\tau_{X^*}^\text{obs}$ is also an unbiased estimator of $\tausutva$.)

\end{itemize}

Bias of naive estimator when unconfoundedness holds:

\begin{itemize}

\item
Theorem~2A: if Assumption~1 holds, Assumption~2 holds given $g_i$ for each unit $i$, Assumption~3 holds conditional on $\bfX_i^*$, then
\begin{align*}
\tau_{X^*}^\text{obs} &= \sum_{\bfx\in\calX^*}\left(\sum_{g\in\calG}\E\left[Y_i(1,g)|\bfX_i^*=\bfx,i\in V_g\right]\P(G_i=g|Z_i=1,\bfX_i^*=\bfx) \right. \\
&\quad -\E\left[Y_i(0,g)|\bfX_i^*=\bfx,i\in V_g\right)\P(G_i=g|Z_i=0,\bfX_i^*=x)\Bigg)\P(\bfX_i^*=\bfx)
\end{align*}

\item
Corollary~1: under the three assumptions of Theorem~2A and the assumption $Z_i\condind G_i|\bfX_i^*$, then $\tau_{X^*}^\text{obs} = \tau$. (If the individual and neighbourhood treatments are conditionally independent on the covariates, then covariate-adjusted estimates that assume SUTVA yield unbiased estimates even if SUTVA does not hold.)

\item
Corollary~2: under the three assumptions of Theorem~2A, if $Z_i\not\condind G_i|\bfX_i^*$, an unbiased estimator of $\tau_{X^*}^\text{obs}$ would be biased for $\tau$. The bias depends on if the spillover effect at level $g$ versus $g'$ is dependent on the individual treatment assignment. (If there is residual correlation between the individual and neighbourhood treatments after conditioning on the covariates, covariate-adjusted estimates that assume SUTVA are biased.)

\end{itemize}

Bias of naive estimator when unconfoundedness does not hold:

\begin{itemize}

\item
Theorem~2B: under Assumptions~1 and 2, if $Y_i(z,g)\not\condind Z_i,G_i|\bfX_i^*$ but $Y_i(z,G)\condind Z_i,G_i|\bfX_i^*,\bfU_i$ for some additional vector of covariates $\bfU_i\in\calU$, then an unbiased estimator of $\tau_{X^*}^\text{obs}$ is biased for the $\tau$. The bias depends on if the spillover effect at level $g$ and $g'$ and if the unmeasured confounder $\bfU_i$ at level $u$ and $u'$ are dependent on the individual treatment.

\item
Corollary~3: under the three assumptions in Theorem~2B and if $Z_i\condind G_i|X_i^*$, then an unbiased estimator of $\tau_{X^*}^\text{obs}$ is biased for the $\tau$ with the bias depending only on the unmeasured confounder $\bfU_i$.

\item
Corollary~4: if SUTVA holds and $Y_i(z,G)\condind Z_i,G_i|\bfX_i^*,\bfU_i$, then an unbiased estimator of $\tau_{X^*}^\text{obs}$ is biased for the $\tau$ with the bias as in Corollary~3.

\item
Theorem~2B says that if SUTVA is wrongly assumed and adjusting for $\bfX_i^*$ is insufficient for unconfoundedness, then the bias is due to both interference and due to unmeasured confounders. If the individual and neighbourhood treatments are conditionally independent given the covariates, then the bias is only due to the unmeasured confounders.

\end{itemize}

\subsection{Generalized propensity scores under neighbourhood interference}

Joint propensity score:

\begin{itemize}

\item
The joint propensity score is defined as the probability for unit $i$ being exposed to individual treatment $z$ and neighbourhood treatment $g$ given observed covariates $\bfx$ and denoted
\[
\psi(z;g;x) = \P(Z_i=z,G_i=g|\bfX_i=\bfx)
\]
Note that this differs from the unit-level treatment assignment probability $\P(Z_i=z,G_i=g|\bfX,\{\bfY(z,g),z\in\{0,1\};g\in\calG\})$ unless the assignment mechanism only depends on the unit-level variables $\bfX_i$ (instead of $\bfX$) and the unconfoundedness assumption (Assumption~3) holds given $\bfX_i$.

\item
Proposition~1 (Balancing property): The joint propensity score is a balancing score, i.e.,
\[
\P(Z_i=z,G_i=g|\bfX_i,\psi(z;g;\bfX_i)) = \P(Z_i=z,G_i=g|\psi(z;g;\bfX_i))
\]
(Distribution of covariates $\bfX$ is the same for units with the same $\psi(z;g;\bfx)$.)

\item
Proposition~2 (Conditional unconfoundedness): If Assumption~3 holds given $\bfX_i$, then for all $z\in\{0,1\}$, $g\in\calG_i$,
\[
Y_i(z,g) \condind Z_i,G_i|\psi(z;g;\bfX_i)
\]
(If unconfoundedness holds, the potential outcome is independent of individual and neighbourhood treatment of units with the same joint propensity score.)

\end{itemize}

Individual and neighbourhood propensity score:

\begin{itemize}

\item
The joint propensity score can be factorized as
\begin{align*}
\psi(z;g;\bfx) &= \P(G_i=g|Z_i=z,\bfX_i^g=\bfx^g)\P(Z_i=z|\bfX_i^z=\bfx^x) \\
&= \lambda(g;z;\bfx^g)\phi(z;\bfx^z)
\end{align*}
where $\bfX_i^g\in\calX^g\subset\calX$ is the subset of covariates affecting the neighbourhood treatment and $\bfX_i^z\in\calX^z\subset\calX$ is the subset of covariates affecting the individual treatment. These subsets may not be mutually exclusive. $\lambda(g;z;\bfx^g)$ is the neighbourhood (generalized) propensity score and $\phi(z;\bfx^z)$ is the individual (binary) propensity score.

\item
Proposition~3 (Conditional unconfoundedness given individual and neighbourhood propensities): if Assumption~3 holds, then for all $z\in\{0,1\}$, $g\in\calG_i$,
\[
Y_i(z,g) \condind Z_i, G_i|\lambda(g;z;\bfX_i^g),\phi(1;\bfX_i^z)
\]
(\todo: is there a typo?)

\end{itemize}

\subsection{Propensity score-based estimator for main and spillover effects}

Individual and neighbourhood propensity score estimator:

\begin{itemize}

\item
Theorem~1 says that an unbiased estimator of the conditional mean $\Yobs$ is unbiased for $\mu(z,g;V)$. If there are many covariates or if the covariates are continuous, then estimation of $\Yobs$ is challenging.

\item
If Assumption~3 holds, by Proposition~2, adjusting for the joint propensity score can also lead to an unbiased estimator for $\mu(z,g;V)$, i.e.,
\[
\E\left[\E\left[Y_i|Z_i=z,G_i=g,\psi(z;g;\bfX_i)\right]|Z_i=z,G_i=g\right]
\]
where the outer expectation is over the empirical distribution of the joint propensity score in the population. By Proposition~3, the propensity score adjustment can be done separately for individual and neighbourhood, leading to the unbiased estimator
\[
\E\left[\E\left[Y_i|Z_i=z,G_i=g,\phi(1;\bfX_i^z),\lambda(g;z;\bfX_i^g)\right]|Z_i=z,G_i=g\right]
\]

\end{itemize}

Estimation procedure:

\begin{enumerate}

\item
Subclassification based on individual propensity score:
\begin{enumerate}
\item
Predict $\phi(1;\bfX_i^z)$ using a logistic regression for $Z_i$ fitted on covariates $\bfX_i^z$.
\item
Identify $J$ subclasses $B_j$ based on similar values of $\phi(1;\bfX_i^z)$ and where there is sufficient balanced between individual treatment groups, i.e., $\bfX_i^z\condind Z_i|i\in B_j$ (given a unit in a subclass, covariates are independent of treatment).
\end{enumerate}

\item
For each subclass $B_j$, estimate $\mu_j(z,g;V_g) = \E\left[Y_i(z,g)|i\in B_j^g\right]$ where $B_j^g= V_g\cap B_j$:
\begin{enumerate}
\item
Estimate parameters of a model for $\lambda(g,z;\bfx^g)$ where $\lambda(g;z;\bfX_i^g) = \P(G_i=g|Z_i=z,\bfX_i^g) = f^G(g,z,\bfX_i^g)$.
\item
Use observed data $(Y_i,Z_i,G_i,\bfX_i^g)$ and $\hat{\Lambda}=\lambda(G_i;Z_i;\bfX_i^g)$ to estimate parameters of a model $Y_i(z,g)|\lambda(g;z;\bfX_i^g) \sim f^Y(z,g,\lambda(g;z;\bfX_i^g))$.
\item
For a particular level of the joint treatment $(Z_i=z,G_i=g)$, for each unit $i\in B_j^g$, predict $\lambda(g;z;\bfX_i^g)$ and use it to predict $Y_i(z,g)$.
\item
Estimate the dose-response function $\mu_j(z,g;V_g)$ by
\[
\hat{\mu}_j(z,g;V_g) = \frac{\sum_{i\in B_j^g}\hat{Y}_i(z,g)}{|B_j^g|}
\]
\end{enumerate}

\item
Estimate the ADRF by
\[
\hat{\mu}(z,g,V_g) = \sum_{j=1}^J\hat{\mu}_j(z,g;V_g)\pi_j^g
\]
where $\pi_j^g=\frac{|B_j^g|}{v_g}$ are weights proportional to the subclass size.

\end{enumerate}


\newpage


\subsection{Key ideas}

\begin{itemize}

\item
Want to estimate main and spillover effects from observational network data. Assumed that network structure is fully known and fixed.

\item
Estimators that assume SUTVA may be biased.
\begin{enumerate}
\item
If the three assumptions hold and if individual and neighbourhood treatment assignments are conditionally independent given a set of covariates, covariate-adjusted estimates of the main effect that assume SUTVA are unbiased.
\item
If the three assumptions hold, covariate-adjusted estimates are biased with the bias depending on the interference effect and the association between individual and neighbourhood treatments.
\item
If unconfoundedness does not hold, covariate-adjusted estimates are biased with the bias due to both interference and the unmeasured confounders.
\item
If unconfoundedness holds given the covariates and unmeasured confounders, and the individual and neighbourhood treatment are conditionally independent given the covariates or there is no interference, then the covariate-adjusted estimates are biased due to only the unmeasured confounders.
\end{enumerate}
In summary: conditional independence of individual and neighbourhood treatment given covariates determines bias from interference; covariates alone satisfying unconfoundedness determines bias from unmeasured confounders.

\item
Relaxing SUTVA to SUTNVA may allow for unbiased estimates if it is assumed that
\begin{enumerate}
\item
outcomes only depend on treatment assignment of the population and not the assignment mechanism (Assumption~1---consistency; also made in SUTVA);
\item
outcome for a unit only depends on individu-al treatment and some summary of neighbourhood treatments (Assumption~2--neighbourhood interference);
\item
given some set of covariates (individual and neighbourhood characteristics), the outcomes are conditionally independent of the assignment mechanism (Assumption~3---unconfoundedness).
\end{enumerate}

\item
The joint propensity score
\begin{enumerate}
\item
is a balancing score (units with the same propensity and treatments have the same distribution of covariates);
\item
also satisfies conditional unconfoundedness if the covariates do;
\item
can be factorized into individual and neighbourhood propensity scores.
\end{enumerate}

\item
To estimate main and spillover effects, use the propensity scores to reduce the space of covariates:
\begin{enumerate}
\item
Classify (match) units into subclasses based on individual propensity scores.
\item
Within each class, obtain estimates of outcomes based on neighbourhood propensities.
\end{enumerate}

\end{itemize}

\subsection{Other literature}

\begin{itemize}

\item
Evaluation of propensity score methods under treatment entanglement in observational studies: \url{https://arxiv.org/pdf/1801.07310.pdf}

\item
Effect estimation under heterogeneous partial inferference in observational studies: \url{https://arxiv.org/pdf/2107.12420.pdf}

\item
Questions justification of unconfounded with respect to a constructed statistic: \url{https://economics.sas.upenn.edu/system/files/2021-03/AlejandroSanchez_JMP_March2021_0.pdf}

\item
Estimating treatment effects in observational networked data (no interference?) using neural networks: \url{https://arxiv.org/pdf/1906.03485.pdf}

\item
Interference in randomized experiments: \url{https://arxiv.org/pdf/1711.06399.pdf}

\item
Testing SUTVA in randomized experiments: \url{https://dl.acm.org/doi/abs/10.1145/3097983.3098192}

\item
Accounting for homophily?: \url{https://arxiv.org/pdf/1705.08527.pdf}

\item
Randomized experiment design for networks with interference (quasi-colouring): \url{https://projecteuclid.org/journals/annals-of-statistics/volume-48/issue-2/Designs-for-estimating-the-treatment-effect-in-networks-with-interference/10.1214/18-AOS1807.short}

\item
Sensitivity analysis in networks with interference (looking at graph structure?) in experiments: \url{https://arxiv.org/pdf/1708.08171.pdf}


\end{itemize}


\newpage

\printbibliography

\end{document}